<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Core3: /Users/victor/git/Core3Mda/MMOCoreORB/src/server/zone/objects/tangible/deed/components/PlaceCityHallComponent.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Core3
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_075bb3ff235063c77951cd176d15a741.html">server</a></li><li class="navelem"><a class="el" href="dir_9e27d73ba17b043ea65c9708c594875e.html">zone</a></li><li class="navelem"><a class="el" href="dir_bb68fceffca92cfae925b7b7ddaff7dd.html">objects</a></li><li class="navelem"><a class="el" href="dir_ce4e9bac9619be26381269d3c4a3e4a0.html">tangible</a></li><li class="navelem"><a class="el" href="dir_1e3a40f78a0c4c489f846f4216505deb.html">deed</a></li><li class="navelem"><a class="el" href="dir_40f50315f030e8483d76f595bfe48e39.html">components</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">PlaceCityHallComponent.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_place_city_hall_component_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * PlaceCityHallComponent.cpp</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Created on: Feb 5, 2012</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Author: xyborn</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_place_city_hall_component_8h.html">PlaceCityHallComponent.h</a>&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_city_manager_8h.html">server/zone/managers/city/CityManager.h</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server_2zone_2objects_2creature_2_creature_object_8h.html">server/zone/objects/creature/CreatureObject.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_deed_8h.html">server/zone/objects/tangible/deed/Deed.h</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_sui_input_box_8h.html">server/zone/objects/player/sui/inputbox/SuiInputBox.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_city_region_8h.html">server/zone/objects/region/CityRegion.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server_2zone_2objects_2player_2_player_object_8h.html">server/zone/objects/player/PlayerObject.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_structure_object_8h.html">server/zone/objects/structure/StructureObject.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_building_object_8h.html">server/zone/objects/building/BuildingObject.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_place_city_hall_sui_callback_8h.html">server/zone/objects/player/sui/callbacks/PlaceCityHallSuiCallback.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_active_area_8h.html">server/zone/objects/area/ActiveArea.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="code" href="class_place_city_hall_component.html#a089843c265cd47a484f1519dd825932c">   20</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_place_city_hall_component.html#a089843c265cd47a484f1519dd825932c">PlaceCityHallComponent::placeStructure</a>(<a class="code" href="classserver_1_1zone_1_1objects_1_1tangible_1_1deed_1_1structure_1_1_structure_deed.html">StructureDeed</a>* deed, <a class="code" href="classserver_1_1zone_1_1objects_1_1creature_1_1_creature_object.html">CreatureObject</a>* creature, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">int</span> angle) {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        <a class="code" href="classserver_1_1zone_1_1objects_1_1player_1_1_player_object.html">PlayerObject</a>* ghost = creature-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1creature_1_1_creature_object.html#a958438b0ec0972ba60fa3cbdb54f0f24">getPlayerObject</a>();</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="keywordflow">if</span> (ghost == NULL)</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <a class="code" href="classserver_1_1zone_1_1_zone.html">Zone</a>* zone = creature-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1scene_1_1_scene_object.html#a83c519b8b1e57fcc329e85689ef9fb1a">getZone</a>();</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <span class="keywordflow">if</span> (zone == NULL)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="comment">//Check the capped cities on this planet.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        <a class="code" href="classserver_1_1zone_1_1managers_1_1city_1_1_city_manager.html">CityManager</a>* cityManager = zone-&gt;<a class="code" href="classserver_1_1zone_1_1_zone.html#a41d96764341fe8476b399ca185dc4980">getZoneServer</a>()-&gt;<a class="code" href="classserver_1_1zone_1_1_zone_server.html#aabad05b5911aa70a9a3202861e48893e">getCityManager</a>();</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keywordflow">if</span> (cityManager-&gt;<a class="code" href="classserver_1_1zone_1_1managers_1_1city_1_1_city_manager.html#a31a3464f59edf2b814aa4c059a61cf2f">isCityRankCapped</a>(zone-&gt;<a class="code" href="classserver_1_1zone_1_1_zone.html#a351fb1c2dc9bfd55792c4c41d0ec3343">getZoneName</a>(), CityManager::OUTPOST)) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                creature-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1creature_1_1_creature_object.html#ad60087a1560819c9da80f4dd19b298ab">sendSystemMessage</a>(<span class="stringliteral">&quot;This planet cannot support anymore cities. You will have to find another planet.&quot;</span>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        uint64 declaredOidResidence = ghost-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1player_1_1_player_object.html#a0174bd18a3f8f399d3cf07f71791f64d">getDeclaredResidence</a>();</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        ManagedReference&lt;BuildingObject*&gt; declaredResidence = zone-&gt;<a class="code" href="classserver_1_1zone_1_1_zone.html#a41d96764341fe8476b399ca185dc4980">getZoneServer</a>()-&gt;<a class="code" href="classserver_1_1zone_1_1_zone_server.html#a8e09d3df7c2e98ad0b5628552ea27df6">getObject</a>(declaredOidResidence).castTo&lt;<a class="code" href="classserver_1_1zone_1_1objects_1_1building_1_1_building_object.html">BuildingObject</a>*&gt;();</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">if</span> (declaredResidence != NULL) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                ManagedReference&lt;CityRegion*&gt; city = declaredResidence-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1scene_1_1_scene_object.html#a6ed514df7f0abf4ca435a11c5b5c6c96">getCityRegion</a>();</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                <span class="keywordflow">if</span> (city != NULL &amp;&amp; city-&gt;isMayor(creature-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1scene_1_1_scene_object.html#ae94c183ef49973a95acfbae3fc382366">getObjectID</a>())) {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                        creature-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1creature_1_1_creature_object.html#ad60087a1560819c9da80f4dd19b298ab">sendSystemMessage</a>(<span class="stringliteral">&quot;@city/city:already_mayor&quot;</span>); <span class="comment">//You are already the mayor of a city.  You may not be mayor of another city.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        ManagedReference&lt;SuiInputBox*&gt; inputBox = <span class="keyword">new</span> <a class="code" href="classserver_1_1zone_1_1objects_1_1player_1_1sui_1_1messagebox_1_1_sui_input_box.html">SuiInputBox</a>(creature, <a class="code" href="class_sui_window_type.html#a0cff412d16d5c42c19cfffa17fab21da">SuiWindowType::CITY_CREATE</a>, 0);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        inputBox-&gt;setPromptTitle(<span class="stringliteral">&quot;@city/city:city_name_t&quot;</span>); <span class="comment">//Enter City Name</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        inputBox-&gt;setPromptText(<span class="stringliteral">&quot;@city/city:city_name_d&quot;</span>); <span class="comment">//Enter the desired name for your new city. Note that you must have at least 10 citizens join your city within 24 hours of placement in order for your city to be approved.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        inputBox-&gt;setForceCloseDisabled();</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        inputBox-&gt;setCallback(<span class="keyword">new</span> <a class="code" href="class_place_city_hall_sui_callback.html">PlaceCityHallSuiCallback</a>(creature-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1scene_1_1_scene_object.html#a83c519b8b1e57fcc329e85689ef9fb1a">getZone</a>(), deed, x, y, angle));</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        ghost-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1player_1_1_player_object.html#a7154531890864f9e6cc348d32caad0a8">addSuiBox</a>(inputBox);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        creature-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1creature_1_1_creature_object.html#ac0a95f597b213ca7c728942bfb8a3760">sendMessage</a>(inputBox-&gt;generateMessage());</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="code" href="class_place_city_hall_component.html#a1069f84743406254e0c7ba27235df96c">   64</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_place_city_hall_component.html#a1069f84743406254e0c7ba27235df96c">PlaceCityHallComponent::notifyStructurePlaced</a>(<a class="code" href="classserver_1_1zone_1_1objects_1_1tangible_1_1deed_1_1structure_1_1_structure_deed.html">StructureDeed</a>* deed, <a class="code" href="classserver_1_1zone_1_1objects_1_1creature_1_1_creature_object.html">CreatureObject</a>* creature, <a class="code" href="classserver_1_1zone_1_1objects_1_1structure_1_1_structure_object.html">StructureObject</a>* structure) {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <a class="code" href="class_place_structure_component.html#a65ff185cfa7e1a82fb5ab6faba40ca66">PlaceStructureComponent::notifyStructurePlaced</a>(deed, creature, structure);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="classserver_1_1zone_1_1objects_1_1player_1_1_player_object.html">PlayerObject</a>* ghost = creature-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1creature_1_1_creature_object.html#a958438b0ec0972ba60fa3cbdb54f0f24">getPlayerObject</a>();</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">if</span> (ghost != NULL &amp;&amp; structure-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1scene_1_1_scene_object.html#af6239c08a91da25525461b4cabe43a0e">isBuildingObject</a>()) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                ManagedReference&lt;CityRegion*&gt; city = structure-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1scene_1_1_scene_object.html#a6ed514df7f0abf4ca435a11c5b5c6c96">getCityRegion</a>();</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                <span class="keywordflow">if</span> (city != NULL &amp;&amp; city-&gt;isMayor(creature-&gt;<a class="code" href="classserver_1_1zone_1_1objects_1_1scene_1_1_scene_object.html#ae94c183ef49973a95acfbae3fc382366">getObjectID</a>())) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                        city-&gt;setCityHall(structure);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                        city-&gt;setLoaded();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                        StructureManager::instance()-&gt;declareResidence(creature, structure);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 15 2013 17:29:07 for Core3 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
